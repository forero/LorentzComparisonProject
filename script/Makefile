#input variables
INPUT_RESOLUTION=256
WEB_RESOLUTION=512
SMOOTH_SCALE=1.00

# Setup executable paths
TVWEB_PATH=/home/forero/Dropbox/TV-Web/src/
EXEC_NAME = ./smooth_bolshoi.x


PATH_RAW=/home/forero/work/data/WebFinderComparison/$(INPUT_RESOLUTION)/
PATH_TWEB=/home/forero/work/data/WebFinderComparison/$(INPUT_RESOLUTION)/Tweb/$(WEB_RESOLUTION)
PATH_VWEB=/home/forero/work/data/WebFinderComparison/$(INPUT_RESOLUTION)/Vweb/$(WEB_RESOLUTION)
SNAP_NAME=snap100Mpc$(INPUT_RESOLUTION)_z0
PATH_POST=../data/$(INPUT_RESOLUTION)/


FILE_SNAP=$(PATH_RAW)/$(SNAP_NAME)

FILE_DENSITY=$(PATH_VWEB)/$(SNAP_NAME).CIC
FILE_VX=$(PATH_VWEB)/$(SNAP_NAME).v0.CIC
FILE_VY=$(PATH_VWEB)/$(SNAP_NAME).v1.CIC
FILE_VZ=$(PATH_VWEB)/$(SNAP_NAME).v2.CIC
FILE_EIGENV_VWEB=$(PATH_VWEB)/$(SNAP_NAME).eigen_1
FILE_EIGENVEC_VWEB=$(PATH_VWEB)/$(SNAP_NAME).eigenvec_1
FILE_EIGENVEC_VWEB_SMOOTH=$(PATH_VWEB)/$(SNAP_NAME).s$(SMOOTH_SCALE).eigenvec_1
FILE_EIGENV_VWEB_SMOOTH=$(PATH_VWEB)/$(SNAP_NAME).s$(SMOOTH_SCALE).eigen_1

#TWEB FILENAMES
FILE_DENSITY_TWEB=$(PATH_TWEB)/$(SNAP_NAME).CIC
FILE_EIGENV_TWEB=$(PATH_TWEB)/$(SNAP_NAME).eigen_1
FILE_EIGENVEC_TWEB=$(PATH_TWEB)/$(SNAP_NAME).eigenvec_1
FILE_EIGENV_TWEB_SMOOTH=$(PATH_TWEB)/$(SNAP_NAME).s$(SMOOTH_SCALE).eigen_1
FILE_EIGENVEC_TWEB_SMOOTH=$(PATH_TWEB)/$(SNAP_NAME).s$(SMOOTH_SCALE).eigenvec_1

$(FILE_VX): $(FILE_SNAP)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) $(FILE_SNAP) -vel -outdir $(PATH_VWEB) -n $(WEB_RESOLUTION)

#this part is giving me a segmentation fault
$(FILE_EIGENV_VWEB): $(FILE_VX)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_VWEB)/$(SNAP_NAME) -outdir $(PATH_VWEB) -vel 

$(FILE_EIGENVEC_VWEB): $(FILE_VX)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_VWEB)/$(SNAP_NAME) -outdir $(PATH_VWEB) -vel -eigenvector

#This part is giving me a segmentation fault
$(FILE_EIGENV_VWEB_SMOOTH): $(FILE_VX)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_VWEB)/$(SNAP_NAME) -outdir $(PATH_VWEB) -vel -s $(SMOOTH_SCALE)

$(FILE_EIGENVEC_VWEB_SMOOTH): $(FILE_VX)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_VWEB)/$(SNAP_NAME) -outdir $(PATH_VWEB) -vel -eigenvector -s $(SMOOTH_SCALE)



# HERE COMES THE TWEB
$(FILE_DENSITY_TWEB): $(FILE_SNAP)
	mkdir -p $(PATH_TWEB)
	$(TVWEB_PATH)$(EXEC_NAME) $(FILE_SNAP) -outdir $(PATH_TWEB) -n $(WEB_RESOLUTION)

$(FILE_EIGENV_TWEB): $(FILE_DENSITY_TWEB)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_TWEB)/$(SNAP_NAME) -outdir $(PATH_TWEB) 

$(FILE_EIGENVEC_TWEB): $(FILE_DENSITY_TWEB)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_TWEB)/$(SNAP_NAME) -outdir $(PATH_TWEB) -eigenvector


$(FILE_EIGENV_TWEB_SMOOTH): $(FILE_DENSITY_TWEB)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_TWEB)/$(SNAP_NAME) -outdir $(PATH_TWEB)  -s $(SMOOTH_SCALE)

$(FILE_EIGENVEC_TWEB_SMOOTH): $(FILE_DENSITY_TWEB)
	mkdir -p $(PATH_VWEB)
	$(TVWEB_PATH)$(EXEC_NAME) -d $(PATH_TWEB)/$(SNAP_NAME) -outdir $(PATH_TWEB) -eigenvector -s $(SMOOTH_SCALE)

vweb: $(FILE_EIGENVEC_VWEB) $(FILE_EIGENVEC_VWEB_SMOOTH) 

tweb: $(FILE_EIGENV_TWEB) $(FILE_EIGENVEC_TWEB) $(FILE_EIGENV_TWEB_SMOOTH) $(FILE_EIGENVEC_TWEB_SMOOTH)

clean_tweb:
	rm -f $(FILE_DENSITY_TWEB)
	rm -f $(FILE_EIGENV_TWEB) $(FILE_EIGENVEC_TWEB)
	rm -f $(FILE_EIGENV_TWEB_SMOOTH) $(FILE_EIGENVEC_TWEB_SMOOTH)

clean:
	rm -f $(FILE_VX) $(FILE_VY) $(FILE_VZ) 
	rm -f $(FILE_EIGENV_VWEB) $(FILE_EIGENVEC_VWEB) $(FILE_EIGENVEC_VWEB_SMOOTH) $(FILE_EIGENV_VWEB_SMOOTH)

